<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>TypeScript Playground</title>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/typescript/5.3.3/typescript.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.52.2/min/vs/loader.js"></script>
        <style>
            body {
                font-family:
                    system-ui,
                    -apple-system,
                    sans-serif;
                margin: 0;
                padding: 20px;
                height: 100vh;
                display: flex;
                flex-direction: column;
            }
            #editor {
                height: 800px;
                border: 1px solid #ccc;
                margin-bottom: 10px;
            }
            button {
                background: #0070f3;
                color: white;
                border: none;
                padding: 10px 20px;
                border-radius: 4px;
                cursor: pointer;
                font-size: 16px;
                margin-bottom: 10px;
            }
            button:hover {
                background: #0051a2;
            }
            #output {
                white-space: pre-wrap;
                font-family: monospace;
                padding: 10px;
                background: #f0f0f0;
                border-radius: 4px;
                flex-grow: 1;
            }
        </style>
    </head>
    <body>
        <h1>VexFlow Playground</h1>
        <div id="editor"></div>
        <button id="runButton">Run Code</button>
        <div id="output"></div>

        <script>
            let editor;
            const initialCode = `
// Write your VexFlow TypeScript code here...
const greeting: string = "Hello, TypeScript!";
console.log(greeting);

// Example: Interface
interface Person {
    name: string;
    age: number;
}

const person: Person = {
    name: "John",
    age: 30
};
console.log(person);







`;

            // Configure Monaco loader
            require.config({
                paths: {
                    vs: "https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.45.0/min/vs",
                },
            });

            // Disable worker
            window.MonacoEnvironment = {
                getWorkerUrl: function (workerId, label) {
                    return `data:text/javascript;charset=utf-8,${encodeURIComponent(`
                    self.MonacoEnvironment = {
                        baseUrl: 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.45.0/min/'
                    };
                    importScripts('https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.45.0/min/vs/base/worker/workerMain.js');`)}`;
                },
            };

            // Load Monaco editor
            require(["vs/editor/editor.main"], function () {
                editor = monaco.editor.create(
                    document.getElementById("editor"),
                    {
                        value: initialCode,
                        language: "typescript",
                        theme: "vs",
                        minimap: { enabled: false },
                        automaticLayout: true,
                        fontSize: 22,
                    },
                );

                // Add click handler after Monaco is loaded
                document
                    .getElementById("runButton")
                    .addEventListener("click", function () {
                        const code = editor.getValue();
                        const output = document.getElementById("output");

                        try {
                            const result = ts.transpileModule(code, {
                                compilerOptions: {
                                    target: ts.ScriptTarget.ES2015,
                                    module: ts.ModuleKind.None,
                                },
                            });

                            const logs = [];
                            const originalConsoleLog = console.log;
                            console.log = (...args) => {
                                logs.push(
                                    args
                                        .map((arg) =>
                                            typeof arg === "object"
                                                ? JSON.stringify(arg, null, 2)
                                                : String(arg),
                                        )
                                        .join(" "),
                                );
                            };

                            eval(result.outputText);
                            console.log = originalConsoleLog;
                            output.textContent = logs.join("\n");
                        } catch (error) {
                            output.textContent = "Error: " + error.message;
                        }
                    });
            });
        </script>
    </body>
</html>
