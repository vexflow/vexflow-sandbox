<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width" />
        <title>VexFlow Sandbox</title>
        <meta name="description" content="VexFlow Sandbox" />
        <meta name="author" content="Ron B. Yeh" />
        <link href="https://fonts.googleapis.com/css?family=Roboto+Slab:400" rel="stylesheet" />
        <style>
            * {
                margin: 12px;
                padding: 0;
                box-sizing: border-box;
                font-family:
                    "Roboto Slab",
                    -apple-system,
                    BlinkMacSystemFont,
                    "Segoe UI",
                    Roboto,
                    Helvetica,
                    Arial,
                    sans-serif,
                    "Apple Color Emoji",
                    "Segoe UI Emoji",
                    "Segoe UI Symbol";
                background-color: #fcfcfb;
                color: #333;
            }
            .title {
                font-size: 2.2em;
                display: flex;
                justify-content: center;
            }
            .versions {
                display: flex;
                justify-content: center;
                align-items: center;
                font-size: 1.2em;
            }

            .content {
                border: 1px solid #aaa;
                min-height: 600px;
                width: 80%;
                background-color: #fefeff;
                margin: 0 auto; /* This centers the div horizontally if you want */
            }
        </style>

        <style>
            body {
                font-family:
                    system-ui,
                    -apple-system,
                    sans-serif;
                max-width: 800px;
                margin: 20px auto;
                padding: 0 20px;
            }
            textarea {
                width: 100%;
                height: 200px;
                font-family: monospace;
                margin-bottom: 10px;
                padding: 10px;
                border: 1px solid #ccc;
                border-radius: 4px;
            }
            button {
                background: #0070f3;
                color: white;
                border: none;
                padding: 10px 20px;
                border-radius: 4px;
                cursor: pointer;
                font-size: 16px;
            }
            button:hover {
                background: #0051a2;
            }
            #output {
                white-space: pre-wrap;
                font-family: monospace;
                padding: 10px;
                background: #f0f0f0;
                border-radius: 4px;
                margin-top: 20px;
            }
        </style>
        <script>
            let currentVersion = 5;

            function getQueryParams() {
                const urlParams = new URLSearchParams(window.location.search);
                const version = urlParams.get("ver");
                if (version) {
                    currentVersion = parseInt(version);
                    setVersion(currentVersion);
                }
            }

            getQueryParams();

            function setVersion(version) {
                delete window.Vex;
                delete window.VexFlow;

                let vfURL = "";
                switch (version) {
                    case 5:
                    default:
                        console.log("Switched to version 5");
                        vfURL = `https://cdn.jsdelivr.net/npm/vexflow@5.0.0/build/cjs/vexflow-debug.js`;
                        break;
                    case 4:
                        console.log("Switched to version 4");
                        vfURL = `https://cdn.jsdelivr.net/npm/vexflow4@4.2.6/build/cjs/vexflow-debug.js`;
                        break;
                    case 3:
                        console.log("Switched to version 3");
                        vfURL = `https://cdn.jsdelivr.net/npm/vexflow@3.0.9/releases/vexflow-debug.js`;
                        break;
                }
                const script = document.createElement("script");
                script.src = vfURL;
                script.onload = function () {
                    // V3 and V4.
                    if (window.Vex) {
                        console.log("Vex is:");
                        console.dir(Vex);
                        // V4.
                        if (Vex.BUILD) {
                            console.log(VexFlow.BUILD);
                        }
                    }
                    // V5 and above.
                    if (window.VexFlow) {
                        console.log("VexFlow is:");
                        console.dir(VexFlow);
                        console.log(VexFlow.BUILD);
                    }
                };
                document.head.appendChild(script);
            }
        </script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/typescript/5.3.3/typescript.min.js"></script>
    </head>
    <body>
        <div class="title">VexFlow Sandbox</div>
        <div class="versions">
            <a href="javascript:setVersion(5)">v5 (current)</a>&nbsp;|&nbsp;<a href="javascript:setVersion(4)">v4</a
            >&nbsp;|&nbsp;<a href="javascript:setVersion(3)">v3</a>
        </div>
        <div class="content"></div>

        <textarea id="code">
// Write your TypeScript code here
const greeting: string = "Hello, TypeScript!";
console.log(greeting);

// Example: Interface
interface Person {
    name: string;
    age: number;
}

const person: Person = {
    name: "John",
    age: 30
};

console.log(person);
        </textarea>
        <br />
        <button onclick="runCode()">Run Code</button>
        Open the console to see the output.
        <script>
            function runCode() {
                const code = document.getElementById("code").value;
                const output = document.getElementById("output");

                try {
                    // Compile TypeScript to JavaScript
                    const result = ts.transpileModule(code, {
                        compilerOptions: {
                            target: ts.ScriptTarget.ES2015,
                            module: ts.ModuleKind.None,
                        },
                    });

                    // Run the code directly
                    eval(result.outputText);
                } catch (error) {
                    output.textContent = "Error: " + error.message;
                }
            }
        </script>
    </body>
</html>
